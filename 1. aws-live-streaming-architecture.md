# AWS 라이브 스트리밍 시스템 아키텍처

## 프로젝트 개요

Larix Broadcaster 앱을 통한 모바일 라이브 스트리밍을 AWS 인프라로 수신, 처리, 배포하는 완전 관리형 라이브 스트리밍 플랫폼

## 핵심 아키텍처 구성

### 1. 스트림 수집 (Ingestion)

**사용 서비스: AWS Elemental MediaLive**

Larix Broadcaster에서 RTMP/RTMPS 프로토콜로 전송된 라이브 스트림을 수신

주요 기능:
- RTMP 입력 엔드포인트 제공
- 실시간 인코딩 및 트랜스코딩
- 다중 해상도 출력 (ABR - Adaptive Bitrate Streaming)
- 장애 조치 및 이중화 지원

설정 항목:
- Input Type: RTMP Push
- Security Group: RTMP 포트 1935 오픈
- Encoder Settings: H.264/AAC 코덱
- Output Groups: HLS 또는 MediaPackage

### 2. 스트림 처리 및 패키징 (Processing)

**사용 서비스: AWS Elemental MediaPackage**

MediaLive에서 전달받은 스트림을 다양한 포맷으로 패키징

주요 기능:
- HLS, DASH, CMAF, MSS 포맷 지원
- 적응형 비트레이트 스트리밍 (ABR)
- DVR 기능 (타임시프트)
- DRM 보안 적용 가능

설정 항목:
- Channel 생성 및 Endpoint 설정
- Manifest 설정 (고화질/중화질/저화질)
- Segment Duration: 6초 권장
- Time Delay: 30-60초 버퍼

### 3. 콘텐츠 배포 (Delivery)

**사용 서비스: Amazon CloudFront**

전 세계 시청자에게 낮은 지연시간으로 스트림 전달

주요 기능:
- 글로벌 CDN 엣지 로케이션 활용
- 캐싱 및 압축 최적화
- HTTPS 보안 전송
- 접근 제어 (Signed URL/Cookie)

설정 항목:
- Origin: MediaPackage Endpoint
- Cache Behavior: TTL 설정
- Viewer Protocol Policy: HTTPS Only
- Geographic Restrictions (선택)

### 4. 스트림 저장 (Storage)

**사용 서비스: Amazon S3**

라이브 스트림 녹화 및 VOD 전환

주요 기능:
- MediaLive Archive Output을 S3 버킷에 저장
- 자동 Lifecycle 정책 적용
- 버전 관리 및 백업
- 다른 서비스와 통합 (Lambda, MediaConvert)

설정 항목:
- Bucket Policy: MediaLive 쓰기 권한
- Lifecycle Rules: 30일 후 Glacier 이동
- Versioning: 활성화
- Server-Side Encryption

### 5. 모니터링 및 관리

**사용 서비스: Amazon CloudWatch**

실시간 모니터링 및 알람 설정

주요 메트릭:
- MediaLive Input/Output 상태
- 비트레이트 및 프레임 레이트
- 에러 및 드롭 프레임
- CloudFront 요청 수 및 대역폭

**사용 서비스: AWS CloudTrail**

API 호출 및 보안 감사

## 네트워크 아키�ecture

```
[Larix Broadcaster (모바일)]
         |
         | RTMP/RTMPS (1935)
         ↓
[AWS MediaLive - Input]
         |
         | Live Encoding
         ↓
[AWS MediaLive - Output]
         |
         | HLS/DASH
         ↓
[AWS MediaPackage]
    |           |
    |           | → [S3 - Archive]
    ↓
[Amazon CloudFront]
         |
         | HTTPS
         ↓
[시청자 - 웹/모바일 플레이어]
```

## 보안 구성

### 1. 인증 및 권한

- IAM Role 기반 권한 관리
- MediaLive Input Security Group
- S3 Bucket Policy
- CloudFront Signed URL (옵션)

### 2. 네트워크 보안

- VPC 내부 통신 (옵션)
- Security Group 규칙
- RTMPS 암호화 전송
- HTTPS 전용 배포

### 3. 데이터 보호

- S3 Server-Side Encryption (SSE-S3/KMS)
- DRM 적용 (PlayReady, Widevine, FairPlay)
- 접근 로그 기록

## 비용 최적화 전략

### 1. MediaLive

- 필요한 시간에만 채널 시작/중지
- Single Pipeline vs Redundant Pipeline 선택
- 적절한 인코더 프로필 사용

### 2. MediaPackage

- Segment 수 제한
- Time-to-Live (TTL) 최적화
- 불필요한 Endpoint 제거

### 3. CloudFront

- Cache Hit Ratio 최적화
- 압축 활성화
- Price Class 선택

### 4. S3

- Lifecycle Policy로 자동 삭제/이동
- Intelligent-Tiering 사용
- Requester Pays (선택)

## 확장 가능한 기능

### 1. 실시간 자막

- MediaLive Caption 기능
- WebVTT, TTML 포맷

### 2. 썸네일 생성

- Lambda + MediaConvert
- S3 Event Trigger

### 3. 시청 분석

- CloudWatch Logs
- Kinesis Data Streams
- QuickSight 대시보드

### 4. 채팅 시스템

- API Gateway + Lambda
- DynamoDB 또는 ElastiCache
- WebSocket 실시간 통신

### 5. 알림 시스템

- SNS (Simple Notification Service)
- EventBridge
- Lambda 트리거

## 다음 단계

1. AWS 계정 설정 및 IAM 권한 구성
2. MediaLive 채널 생성 및 Input 설정
3. MediaPackage 채널 및 Endpoint 구성
4. CloudFront Distribution 생성
5. Larix Broadcaster RTMP 설정
6. 테스트 스트리밍 및 모니터링
7. 웹 플레이어 통합
8. 보안 및 최적화 적용
