# AWS 라이브 스트리밍 프로젝트 구조 및 진행 전략

## 권장 접근 방식: 단계별 서비스 분리

### 왜 나눠야 하는가?

1. **비용 관리**
   - MediaLive는 시간당 과금 (채널 실행 중일 때만)
   - 테스트 중 불필요한 비용 발생 방지
   - 각 단계별 비용 측정 가능

2. **디버깅 용이성**
   - 문제 발생 시 특정 서비스만 집중 분석
   - 로그와 메트릭을 단계별로 확인
   - 각 연결 지점에서 데이터 흐름 검증

3. **학습 곡선**
   - 각 AWS 서비스의 동작 방식 이해
   - 설정값의 영향도 파악
   - 트러블슈팅 경험 축적

4. **유연한 확장**
   - 필요한 기능만 선택적 구축
   - 나중에 추가 기능 통합 용이
   - 아키텍처 변경 시 영향 범위 최소화

## 추천 진행 순서

### Phase 1: 기본 인프라 (필수)
- VPC, Subnet, Security Group
- IAM Roles & Policies
- S3 Bucket
- 비용: 거의 무료 (S3 저장 공간만)
- 소요 시간: 30분

### Phase 2: 스토리지 & 아카이브 (선택)
- S3 설정 완료
- Lifecycle Policy
- 비용: $0.023/GB/월
- 소요 시간: 15분

### Phase 3: MediaPackage (핵심)
- 채널 및 엔드포인트 생성
- HLS 패키징 설정
- 비용: $0.06/GB Egress (출력 데이터 기준)
- 소요 시간: 45분

### Phase 4: MediaLive (핵심, 고비용)
- Input 생성
- 채널 및 인코더 설정
- Output Groups 연결
- 비용: $2.82/시간 (HD Single Pipeline 기준)
- 소요 시간: 1시간
- **주의: 채널 시작 전까지는 과금 없음**

### Phase 5: CloudFront (필수)
- Distribution 생성
- Cache Behavior 설정
- 비용: $0.085/GB 전송 (첫 10TB)
- 소요 시간: 30분 (전파 시간 포함)

### Phase 6: 모니터링 (권장)
- CloudWatch Dashboard
- Alarms 설정
- 비용: 대시보드당 $3/월
- 소요 시간: 45분

### Phase 7: 자동화 (선택)
- Lambda 함수
- EventBridge Rules
- 비용: 거의 무료 (호출 횟수 기준)
- 소요 시간: 1시간

## 단계별 테스트 포인트

### Phase 3 완료 후 테스트
```bash
# MediaPackage Endpoint가 생성되었는지 확인
curl -I https://xxxx.mediapackage.ap-northeast-2.amazonaws.com/out/v1/xxxx/index.m3u8
# 404 또는 403은 정상 (아직 입력 스트림 없음)
```

### Phase 4 완료 후 테스트
```bash
# MediaLive Input URL 확인
# Larix Broadcaster로 5분 테스트 스트리밍
# MediaPackage 엔드포인트에서 .m3u8 파일 확인
```

### Phase 5 완료 후 테스트
```bash
# CloudFront URL로 플레이어 테스트
# HLS.js 또는 VLC로 재생 확인
```

## 각 Phase별 독립 실행 가능 여부

| Phase | 독립 실행 | 의존성 |
|-------|----------|--------|
| Phase 1 | ✅ 가능 | 없음 |
| Phase 2 | ✅ 가능 | Phase 1 |
| Phase 3 | ✅ 가능 | Phase 1 |
| Phase 4 | ❌ 불가능 | Phase 1, 3 필수 |
| Phase 5 | ⚠️ 가능하나 의미 없음 | Phase 3 필요 |
| Phase 6 | ✅ 가능 | Phase 1 |
| Phase 7 | ✅ 가능 | Phase 4 |

## Terraform 모듈 구조

```
terraform/
├── modules/
│   ├── network/              # VPC, Security Groups
│   ├── iam/                  # Roles & Policies
│   ├── storage/              # S3 Buckets
│   ├── mediapackage/         # MediaPackage Channel & Endpoints
│   ├── medialive/            # MediaLive Input & Channel
│   ├── cloudfront/           # CloudFront Distribution
│   ├── monitoring/           # CloudWatch Dashboard & Alarms
│   └── automation/           # Lambda Functions & EventBridge
├── environments/
│   ├── dev/
│   │   ├── main.tf
│   │   ├── variables.tf
│   │   └── terraform.tfvars
│   ├── staging/
│   └── production/
└── README.md
```

## 모듈별 입출력

### network 모듈
**Output:**
- vpc_id
- subnet_ids
- security_group_id

### iam 모듈
**Output:**
- medialive_role_arn
- lambda_role_arn

### storage 모듈
**Input:**
- iam_role_arn
**Output:**
- archive_bucket_name
- archive_bucket_arn

### mediapackage 모듈
**Output:**
- channel_id
- hls_endpoint_url
- hls_ingest_url
- credentials (username/password)

### medialive 모듈
**Input:**
- iam_role_arn
- security_group_id
- mediapackage_channel_id
- archive_bucket_name
**Output:**
- input_id
- rtmp_push_urls
- channel_id

### cloudfront 모듈
**Input:**
- mediapackage_endpoint_url
**Output:**
- distribution_domain_name
- distribution_id

## 비용 시뮬레이션

### 최소 구성 (1시간 테스트)
- MediaLive HD Single: $2.82
- MediaPackage: $0.06 × 2GB = $0.12
- CloudFront: $0.085 × 2GB = $0.17
- S3: $0.023 × 2GB = $0.05
- **총합: ~$3.16**

### 일일 4시간 운영 (30일)
- MediaLive: $2.82 × 4 × 30 = $338.40
- MediaPackage: $0.06 × 240GB = $14.40
- CloudFront: $0.085 × 240GB = $20.40
- S3: $0.023 × 240GB = $5.52
- **총합: ~$378.72/월**

### 비용 절감 팁
1. Single Pipeline 사용 (Redundant는 2배 비용)
2. 낮은 해상도 테스트 (720p 또는 480p)
3. 짧은 Segment Duration (저장 공간 절약)
4. S3 Lifecycle로 7일 후 자동 삭제
5. 사용하지 않을 때 MediaLive 채널 중지

## 권장 진행 방식

### 옵션 A: 순차적 전체 구축 (초보자 권장)
**장점:**
- 전체 흐름을 단계별로 이해
- 각 단계에서 확실한 테스트
- 문제 발생 시 격리 용이

**진행:**
1. Phase 1~3 먼저 구축 (Terraform 적용)
2. 테스트 및 검증
3. Phase 4 추가 (MediaLive)
4. Larix로 스트리밍 테스트
5. Phase 5 추가 (CloudFront)
6. 최종 테스트 후 Phase 6~7 추가

### 옵션 B: 핵심만 빠르게 (경험자 권장)
**장점:**
- 빠른 PoC 구현
- 필요한 기능만 선택

**진행:**
1. Phase 1, 3, 4, 5 한번에 구축
2. 즉시 테스트
3. 문제 있으면 로그로 디버깅
4. 안정화 후 나머지 추가

### 옵션 C: 테스트 환경 먼저 (실전 권장)
**장점:**
- 비용 최소화
- 완벽한 검증 후 프로덕션 배포

**진행:**
1. dev 환경에 최소 구성
2. 충분한 테스트 (1주일)
3. 문제 해결 및 최적화
4. prod 환경에 전체 구성 배포

## 제가 추천하는 방법

**당신의 상황: Larix Broadcaster로 포트폴리오 제작**

1. **Phase 1~3 먼저 구축** (Terraform 적용)
   - 비용 거의 없음
   - 기본 구조 이해
   - MediaPackage 엔드포인트 확보

2. **Phase 4 추가하고 즉시 테스트**
   - MediaLive 채널 생성 (아직 시작 안 함)
   - Larix 설정 완료
   - 채널 시작 → 5분 테스트 → 즉시 중지
   - 비용: $0.24 (5분)

3. **Phase 5 추가**
   - CloudFront로 최종 URL 확보
   - 플레이어 페이지 제작

4. **포트폴리오 문서화**
   - 아키텍처 다이어그램
   - 설정 스크린샷
   - 테스트 영상 (화면 녹화)
   - 비용 분석 리포트

5. **Phase 6~7은 선택**
   - 모니터링은 보너스 점수
   - 자동화는 고급 기능 어필

## 다음 단계

제가 제공할 것:
1. ✅ 모듈화된 Terraform 코드 (각 Phase별)
2. ✅ 각 모듈별 README.md
3. ✅ 변수 파일 템플릿
4. ✅ 단계별 적용 스크립트

당신이 할 것:
1. AWS 계정 준비 및 CLI 설정
2. Terraform 설치
3. 변수 값 입력 (리전, 프로젝트명 등)
4. 순차적으로 terraform apply
5. 각 단계마다 테스트 및 검증

준비되셨나요? 어떤 옵션으로 진행하시겠어요?
